#!/bin/bash
set -euo pipefail

echo "Checking version consistency (auto-pull mode)..."

git fetch --quiet

# Try a non-interactive pull with rebase and autostash
if ! git pull --rebase --autostash --quiet; then
  echo "Auto-pull failed (likely conflicts). Please resolve them manually (git status), then re-run commit."
  exit 1
fi

# Run version sync
node scripts/version.js sync

# Stage ALL changed files (including package.json and any files that were auto-formatted)
git add -u || true

echo "âœ… Version consistency ensured (auto-pull)"
exit 0